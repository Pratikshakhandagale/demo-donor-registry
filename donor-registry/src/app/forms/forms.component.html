<app-header *ngIf="header != null" [headerFor]='header'></app-header>
<ng-template #noModal>
  <div class="mt-120"></div>
  <div class="col-md-10 offset-md-1 mt-5">
    <h3 class="font-weight-bold">  {{headingTitle}}</h3>
    <div class="card mb-5">
      <div *ngIf="schemaloaded; else loader" class="card-body">
        <div class="signupForm">
          <!-- <form [formGroup]="form2" (ngSubmit)="submit()" *ngIf="fields">
            <formly-form [model]="model" [fields]="fields" [options]="options" [form]="form2"></formly-form>
            <button id="submitBtn" type="submit" class="btn btn-primary w-100 submit-button" [disabled]="!form2.valid" data-toggle="modal" data-target="#exampleModal">{{'SUBMIT' | translate}}</button>
          </form> -->

          <form [formGroup]="form2" (ngSubmit)="submit()">
            <formly-form [model]="model" [fields]="fieldsNew" [options]="options" [form]="form2"></formly-form>
           <spna style="font-size: 12px;" >Note: (i) Organ donation is a family decision. Therefore, it is important that you discuss your decision with family members and loved ones so that it will be easier for them to follow through with your wishes. (ii) One copy of the pledge form/pledge card to be with respective networking organisation, one copy to be retained by institution where the pledge is made and one copy to be handed over to the pledger.(iii) The person making the pledge has the option to withdraw the pledge",</spna>

            <button type="submit" class="btn btn-primary submit-button float-end" [disabled]="!form2.valid"  data-toggle="modal" data-target="#confirmationModal">Register</button>
          </form>

        </div>
        <div class="text-center text-secondary-color p-3 font-weight-bold" *ngIf="isSignupForm"> 
          <!-- <a  href="/login"> {{'ALREADY_REGISTERED_LOGIN' | translate}}? </a> -->
         </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Button trigger modal -->

<!--confirmation Modal -->
<div id="myModal" class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="p-4 modal-content">   
      <div class="modal-body">
        <div class="d-flex flex-column justify-content-center align-items-center">
         <div><img class="check-logo" src="assets/images/circle-check.png"></div>
        <div class="p14 mb-2 mt-2 fw-bold"> Confirm Pledge Registration</div>
        <div class="p14 mb-2 mt-2 fw-bold">Please confirm to submit details</div>
        <div class="container-fluid mt-3">
        <button data-dismiss="modal"  class="btn btn-bg nav-link-color btn-sec-bg mb-2">Cancel</button>
        <a class="mt-3">
        <button id=""type="submit" class="btn btn-primary float-end submit-button mb-2" data-toggle="modal" data-target="#downloadCardModal" data-dismiss="modal">OK, Confirm</button>
        </a>
      </div>
      </div>
    </div>
    </div>
  </div>
</div>

<!--confirmation Modal -->

<!--Download card Modal -->
<div id="myModal" class="modal fade" id="downloadCardModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="p-4 modal-content">
    
      <div class="modal-body">
        <div class="d-flex flex-column justify-content-center align-items-center">
         <div><img class="check-logo" src="assets/images/circle-check.png"></div>
        <div class="p14 mb-2 mt-2 fw-bold"> Donor Pledge Registration Completed</div>
        <div class="p14 mb-2 mt-2 fw-bold">You can download the Donor Card </div>
        <a  href="/login" class="mt-3"> 
        <button id=""type="submit" class="btn btn-primary submit-button mb-2">{{'OK' | translate}}</button>
        </a>
      </div>
    </div>
    </div>
  </div>
</div>

<!--Download card  Modal -->

<div *ngIf="schemaloaded; else loader" class="card-body">
  <div *ngIf="modal==='true'; else noModal" class="modal-body">
    <form [formGroup]="form2" (ngSubmit)="submit()" *ngIf="fields">
     <div *ngIf="globalPrivacy" class="mb-3">
        <h6 class="mb-1 p12 font-weight-bold">{{'VISIBILITY' | translate}}</h6>
        <span class="p12"> {{'PRIVACY_ATTRIBUTE_DEFINE' | translate}} <span class="float-end {{globalPrivacy}}">
          <span  *ngIf="globalPrivacy == 'public-access'"> &nbsp; {{'ANYONE' | translate}}</span>
          <span *ngIf="globalPrivacy == 'internal-access'"> &nbsp;{{'ONLY_BY_ME' | translate}}</span>
          <span *ngIf="globalPrivacy == 'private-access'"> &nbsp;{{'ONLY_BY_CONSENT' | translate}}</span>
           </span></span>
      </div>
      <formly-form [model]="model" [fields]="fields" [options]="options" [form]="form2"></formly-form>
      <button type="submit" id="btn-one" class="btn btn-primary submit-button" [disabled]="!form2.valid || isSubmitForm || form2.pristine">{{'SUBMIT' | translate}}</button>
    </form>



    <div class="notes-div my-5" *ngIf="notes">
      <h6>{{'NOTES' | translate}}</h6>
      <div class=" p-3">
        <!-- multiple note -->
        <div class="mb-3" *ngFor="let note of notes">
          <div *ngIf="note?.notes" class=" border-bottom"> 
            <h6 class="mb-1">{{note.notes}}</h6>
            <span class="fs-7  text-grey-color">
              <span *ngIf="note.addedBy"> By {{note.addedBy}}, </span>
              <span *ngIf="note.createdAt"> {{note.createdAt | date : 'd MMM y'}}</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <div class="text-center text-secondary-color p14 font-weight-bold" *ngIf="isSignupForm">
 <a  href="/login"> {{'ALREADY_REGISTERED_LOGIN' | translate}}? </a>
</div> -->
<ng-template #loader>
  <br>
  <div class="d-flex justify-content-center">
    <div class="spinner-border" style="width: 5rem; height: 5rem;" role="status">
      <span class="sr-only">{{'LOADING'| translate}}| translate}}...</span>
    </div>
  </div>
</ng-template>

<script>
    $('#btn-one').click(function () {
        $('#btn-one').html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>Loading...').addClass('disabled');
    });
</script>
